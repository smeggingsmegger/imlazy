#!/usr/bin/env python
import subprocess

try:
    import click
except ImportError:
    subprocess.run(['pip', 'install', 'click'])
    import click

try:
    import docker
except ImportError:
    subprocess.run(['pip', 'install', 'docker'])
    import docker

try:
    import questionary
except ImportError:
    subprocess.run(['pip', 'install', 'questionary'])
    import questionary


@click.command()
@click.option('--filter', default=None, help='Limit container names to ones with this string.')
def dockerssh(filter=None):
    """
    Gets a list of running docker containers and presents them
    as a terminal GUI-choice to the user. Optionally, you can
    choose a string to filter against the list of container names.
    """
    client = docker.from_env()
    if filter:
        containers = [c.name for c in client.containers.list() if filter in c.name]
    else:
        containers = [c.name for c in client.containers.list()]
    which = questionary.select("Enter which container?", choices=containers).ask()
    command = 'docker exec -it {} bash'.format(which)
    pieces = command.split(' ')
    print("Entering {}...".format(which))
    subprocess.run(pieces)


if __name__ == '__main__':
    dockerssh()
